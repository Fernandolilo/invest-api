<div class="parent">
  <div class="wrapper">
    <form #cadastroForm="ngForm" (ngSubmit)="save(cadastroForm)" class="needs-validation" novalidate>
      <h3>Cadastro</h3>

      <!-- Etapa 1: Informações Pessoais -->
      <ng-container *ngIf="step === 1">
        <h3>Informações Pessoais</h3>

        <div class="mb-3">
          <label class="form-label">Nome</label>
          <input type="text" class="form-control" [(ngModel)]="cad.nome" name="nome" required minlength="3" />
        </div>

        <div class="mb-3">
          <label class="form-label">CPF ou CNPJ</label>
          <input type="text" class="form-control" [(ngModel)]="cad.cpfOuCnpj" name="cpfOuCnpj" required />
        </div>

        <div class="mb-3">
          <label class="form-label">Celular</label>
          <input type="text" class="form-control" [(ngModel)]="cad.celular" name="celular" required />
        </div>

        <div class="mb-3">
          <label class="form-label">Telefone</label>
          <input type="text" class="form-control" [(ngModel)]="cad.telefone" name="telefone" />
        </div>

        <div class="mb-3">
          <label class="form-label">Tipo de Pessoa</label>
          <select class="form-select" [(ngModel)]="cad.tipo" name="tipo" required>
            <option value="" disabled selected>Selecione</option>
            <option value="fisica">Pessoa Física</option>
            <option value="juridica">Pessoa Jurídica</option>
          </select>
        </div>

        <button type="button" class="btn btn-primary" (click)="goToStep2()">Próximo</button>
      </ng-container>

      <!-- Etapa 2: Endereço -->
      <ng-container *ngIf="step === 2">
        <h3>Endereço</h3>

        <div class="mb-3">
          <label class="form-label">CEP</label>
          <input type="text" class="form-control" [(ngModel)]="end.cep" name="cep" required />
        </div>

        <div class="mb-3">
          <label class="form-label">Logradouro</label>
          <input type="text" class="form-control" [(ngModel)]="end.logradouro" name="logradouro" required />
        </div>

        <div class="mb-3">
          <label class="form-label">Número</label>
          <input type="text" class="form-control" [(ngModel)]="end.numero" name="numero" required />
        </div>

        <div class="mb-3">
          <label class="form-label">Complemento</label>
          <input type="text" class="form-control" [(ngModel)]="end.complemento" name="complemento" />
        </div>

        <div class="mb-3">
          <label class="form-label">Bairro</label>
          <input type="text" class="form-control" [(ngModel)]="end.bairro" name="bairro" required />
        </div>

        <div class="mb-3">
          <label class="form-label">Cidade</label>
          <input type="text" class="form-control" [(ngModel)]="end.cidade" name="cidade" required />
        </div>

        <div class="mb-3">
          <label class="form-label">Estado</label>
          <input type="text" class="form-control" [(ngModel)]="end.estado" name="estado" required />
        </div>

        <div class="d-flex justify-content-between">
          <button type="button" class="btn btn-secondary" (click)="goToStep1()">Voltar</button>
          <button type="button" class="btn btn-primary" (click)="goToStep3()">Próximo</button>
        </div>
      </ng-container>

      <!-- Etapa 3: Conta de Acesso -->
      <ng-container *ngIf="step === 3">
        <h3>Conta de Acesso</h3>

        <div class="mb-3">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" [(ngModel)]="cad.email" name="email" required />
        </div>

        <div class="mb-3">
          <label class="form-label">Senha</label>
        <input type="password" class="form-control" [(ngModel)]="cad.senha" name="senha" required minlength="6" />
        </div>

        <div class="mb-3 form-check">
          <input type="checkbox" class="form-check-input" [(ngModel)]="cad.confirme" name="confirme" />
          <label class="form-check-label">Confirmo os dados e aceito os termos</label>
        </div>

        <!-- Câmera -->
        <div class="mb-3">
          <label class="form-label">Selfie</label>
          <app-camera (selfieCaptured)="onSelfieCaptured($event)"></app-camera>
          <div *ngIf="selfieDataUrl">
            <img [src]="selfieDataUrl" class="img-thumbnail mt-2" alt="Selfie Capturada" />
          </div>
        </div>

        <div class="d-flex justify-content-between">
          <button type="button" class="btn btn-secondary" (click)="goToStep2()">Voltar</button>
          <button
            type="submit"
            class="btn btn-success"
            [disabled]="
              !selfieDataUrl ||
              !cad.confirme ||
              !validateEmail(cad.email) ||
              !cad.senha ||
              cad.senha.length < 6
            "
          >
            Finalizar Cadastro
          </button>
        </div>
      </ng-container>
    </form>
  </div>
</div>
